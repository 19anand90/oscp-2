function save(a){var e={};e.name=$("#name").val();var t=CKEDITOR.instances.html_editor;e.html=t.getData(),a!=-1?(e.id=pages[a].id,api.trainingPageId.put(e).success(function(a){successFlash("Page edited successfully!"),load(),dismiss()})):api.trainingPages.post(e).success(function(a){successFlash("Page added successfully!"),load(),dismiss()}).error(function(a){modalError(a.responseJSON.message)})}function dismiss(){$("#modal\\.flashes").empty(),$("#name").val(""),$("#html_editor").val(""),$("#url").val(""),$("#modal").modal("hide")}function deletePage(a){swal({title:"Are you sure?",text:"This will delete the page. This can't be undone!",type:"warning",animation:!1,showCancelButton:!0,confirmButtonText:"Delete Page",confirmButtonColor:"#428bca",reverseButtons:!0,allowOutsideClick:!1,preConfirm:function(){return new Promise(function(e,t){api.trainingPageId.delete(pages[a].id).success(function(a){e()}).error(function(a){t(a.responseJSON.message)})})}}).then(function(){swal("Page Deleted!","This page has been deleted!","success"),successFlash("Page deleted successfully!"),$('button:contains("OK")').on("click",function(){load()})})}function edit(a){$("#modalSubmit").unbind("click").click(function(){save(a)}),$("#html_editor").ckeditor();var e={};a!=-1&&(e=pages[a],$("#name").val(e.name),$("#html_editor").val(e.html))}function copy(a){$("#modalSubmit").unbind("click").click(function(){save(-1)}),$("#html_editor").ckeditor();var e=pages[a];$("#name").val("Copy of "+e.name),$("#html_editor").val(e.html)}function load(){$("#pagesTable").hide(),$("#emptyMessage").hide(),$("#loading").show(),api.trainingPages.get().success(function(a){if(pages=a,$("#loading").hide(),pages.length>0){$("#pagesTable").show();var e=$("#pagesTable").DataTable({destroy:!0,columnDefs:[{orderable:!1,targets:"no-sort"}]});e.clear(),$.each(pages,function(a,t){e.row.add([t.name,moment(t.modified_date).format("MMMM Do YYYY, h:mm:ss a"),"<div class='pull-right'><span data-toggle='modal' data-target='#modal'><button class='btn btn-primary' data-toggle='tooltip' data-placement='left' title='Edit Page' onclick='edit("+a+")'>                    <i class='fa fa-pencil'></i>                    </button></span>\t\t    <span data-toggle='modal' data-target='#modal'><button class='btn btn-primary' data-toggle='tooltip' data-placement='left' title='Copy Page' onclick='copy("+a+")'>                    <i class='fa fa-copy'></i>                    </button></span>                    <button class='btn btn-danger' data-toggle='tooltip' data-placement='left' title='Delete Page' onclick='deletePage("+a+")'>                    <i class='fa fa-trash-o'></i>                    </button></div>"]).draw()}),$('[data-toggle="tooltip"]').tooltip()}else $("#emptyMessage").show()}).error(function(){$("#loading").hide(),errorFlash("Error fetching pages")})}var pages=[];$(document).ready(function(){$(".modal").on("hidden.bs.modal",function(a){$(this).removeClass("fv-modal-stack"),$("body").data("fv_open_modals",$("body").data("fv_open_modals")-1)}),$(".modal").on("shown.bs.modal",function(a){"undefined"==typeof $("body").data("fv_open_modals")&&$("body").data("fv_open_modals",0),$(this).hasClass("fv-modal-stack")||($(this).addClass("fv-modal-stack"),$("body").data("fv_open_modals",$("body").data("fv_open_modals")+1),$(this).css("z-index",1040+10*$("body").data("fv_open_modals")),$(".modal-backdrop").not(".fv-modal-stack").css("z-index",1039+10*$("body").data("fv_open_modals")),$(".modal-backdrop").not("fv-modal-stack").addClass("fv-modal-stack"))}),$.fn.modal.Constructor.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(a){this.$element[0]===a.target||this.$element.has(a.target).length||$(a.target).closest(".cke_dialog, .cke").length||this.$element.trigger("focus")},this))},$("#modal").on("hidden.bs.modal",function(a){dismiss()}),load()});